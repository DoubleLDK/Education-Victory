{% extends "basic.html" %}
{% load static %}
{% block extra_css %}
  <style>
    /* Custom timeline styles */
    .timeline {
      position: relative;
      padding-left: 20px;
      list-style: none;
    }

    .timeline::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      left: 10px;
      width: 2px;
      background-color: #e5e5e5;
    }

    .timeline-item {
      margin-bottom: 20px;
    }

    .timeline-marker {
      display: block;
      width: 12px;
      height: 12px;
      background-color: #3273dc;
      border-radius: 50%;
      position: absolute;
      left: 4px;
      top: 0;
    }

    .timeline-content {
      padding-left: 30px;
    }
    .tab-li {
       position: relative;
    }
  </style>
{% endblock %}
{% block content %}
<span id="vue-span">
  <section class="section">
    <div class="container">
      <h1 class="mt-10 mb-10 title is-size-2-mobile is-size-3-tablet" style="letter-spacing: -0.04em;">Practice</h1>
      <div class="columns">
        <div class="column is-4">
        </div>
        <div class="column is-8">
          <div ref="mapContainer" id="mapContainer"></div>
          <div ref="legendContainer"></div>
        </div>
      </div>
    </div>
  </section>
  <section class="section">
    <div class="container">
      <div class="columns">
      <!-- Left column with two cards -->
        <div class="column is-4">
          <div class="tabs is-centered">
          <ul>
            <li class="is-active tab-li">
              <a>
                <span class="icon is-small"><i class="fas fa-image" aria-hidden="true"></i></span>
                <span>Topics</span>
              </a>
            </li>
          </ul>
        </div>
        <!-- Card 1 -->
        <div class="card mb-4">
          <div class="card-content">
            <p class="title">Recommend</p>
            <p class="subtitle">recommend based on your config</p>
            <!-- Card content -->
          </div>
        </div>

        <!-- Card 2 -->
        <div class="card">
          <div class="card-content">
            <p class="title">Card 2</p>
            <p class="subtitle">Card subtitle</p>
            <!-- Card content -->
          </div>
        </div>
      </div>

      <!-- Right column with the timeline -->
      <div class="column">
        <div class="tabs is-centered">
          <ul>
            <li class="is-active tab-li">
              <a>
                <span class="icon is-small"><i class="fas fa-image" aria-hidden="true"></i></span>
                <span>Pictures</span>
              </a>
            </li>
            <li>
              <a>
                <span class="icon is-small"><i class="fas fa-music" aria-hidden="true"></i></span>
                <span>Music</span>
              </a>
            </li>
            <li>
              <a>
                <span class="icon is-small"><i class="fas fa-film" aria-hidden="true"></i></span>
                <span>Videos</span>
              </a>
            </li>
            <li>
              <a>
                <span class="icon is-small"><i class="far fa-file-alt" aria-hidden="true"></i></span>
                <span>Documents</span>
              </a>
            </li>
          </ul>
        </div>
        <ul class="timeline">
          <!-- Timeline item 1 -->
          <li class="timeline-item">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <div class="card">
            <div class="card-content">
              <span class="tag is-info top">New</span>
              <div class="content is-flex is-justify-content-space-between is-align-items-center">
                <div>
                  <h2 class="title is-size-5 mb-1">Binary tree</h2>
                  <span class="is-size-6">HIGH</span>
                </div>
              </div>
              <div class="content mb-1 is-flex is-justify-content-space-between is-align-items-center">
                <p class="mb-0 is-size-6" >Estimated time</p>
                <span class="tag is-success is-light">60 minutes</span>
              </div>
              <div class="content mb-1 is-flex is-justify-content-space-between is-align-items-center">
                <p class="mb-0 is-size-6">Content</p>
                <span class="tag is-success is-light">5 questions</span>
              </div>
            </div>
            <div class="card-footer">
              <div class="card-footer-item" style="width: 100%;">
                <div class="is-flex is-justify-content-space-between is-align-items-center" style="width: 100%;">
                  <a class="button is-link ml-auto" href="#">Start</a>
                </div>
              </div>
            </div> <!-- end card-footer -->
          </div> <!-- end card -->
            </div>
          </li>

          <!-- Timeline item 2 -->
          <li class="timeline-item">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <div class="card">
                <div class="card-content">
                  <p class="title is-4">Binary Search</p>
                  <p class="subtitle is-6">15 minutes</p>
                  <!-- More content here -->
                </div>
              </div>
            </div>
          </li>

          <!-- Timeline item 3 -->
          <li class="timeline-item">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <div class="card">
                <div class="card-content">
                  <p class="title is-4">Merge Sort</p>
                  <p class="subtitle is-6">20 minutes</p>
                  <!-- More content here -->
                </div>
              </div>
            </div>
          </li>

          <!-- Timeline item 4 -->
          <li class="timeline-item">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <div class="card">
                <div class="card-content">
                  <p class="title is-4">Dynamic Programming</p>
                  <p class="subtitle is-6">30 minutes</p>
                  <!-- More content here -->
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>

    </div>
  </div>
</section>
</span>

{% endblock %}
{% block extra_script %}
  <script src="{% static 'js/d3.7.8.5.js' %}"></script>
  <script src="{% static 'js/gridmap.js' %}"></script>
  <script src="{% static 'js/legend.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.13/dist/plot.umd.min.js"></script>
  <script>
    var root = '{{ root }}';
    const config = {
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken,
      },
    };
    var app = new Vue({
      delimiters: ['[[', ']]'],
      el: '#vue-span',
      data () {
        const number = 123;
        const thisMonth = "February";
        const extent = [641, 30402]; // Local variable
        const colors = d3.scaleSequential(d3.interpolateRdPu).domain(extent);
        const formatNum = d3.format(","); // Local variable
        const mapData = [
  { col: 11, row: 0, code: "ME", state: "Maine", values: [3237], total: 3237 },
  { col: 0, row: 1, code: "AK", state: "Alaska", values: [1516], total: 1516 },
  { col: 4, row: 7, code: "TX", state: "Texas", values: [130402], total: 130402 },
  { col: 9, row: 7, code: "FL", state: "Florida", values: [69498], total: 69498 }
];
        const cells = this.createCells(mapData, extent, colors, formatNum);
        return {
           width: 650,
           mapWidth: 635,
           colors,
           cells,
           margin: (800 - 635) / 2,
           focus: null,
           timeout: null,
           threshold: extent[1] / 3,
        }
      },
      mounted () {
        this.createGridMap();
        this.updateState(null);
      },
      methods: {
        createGridMap() {
          const mapWidth = 635;
          const margin = (this.width - this.mapWidth) / 2;
          const gridMap = d3.select(
            Plot.plot({
              width: this.width,
              height: 400,
              padding: 0,
              marginTop: 10,
              marginBottom: 10,
              marginLeft: margin,
              marginRight: margin,
              x: { axis: null },
              y: { axis: null },
              color: { type: "identity" },
              marks: this.cells
            })
          );
          this.$refs.mapContainer.appendChild(gridMap.node());
          const rect = gridMap.selectAll("rect");
          rect.on("pointerover", this.highlight)
              .on("pointerout", this.restore)
              .on("click", this.handleClick)
              .on("pointerdown", this.handlePointerDown)
              .on("pointerup", this.handlePointerUp)
              .style("cursor", "default");
        },
        createCells(mapData, extent, colors, formatNum) {
          const threshold = extent[1] / 3;
          return [
            Plot.cell(mapData, {
              x: "col",
              y: "row",
              rx: 6,
              ry: 6,
              fill: (d) => colors(d.total),
              stroke: (d) => colors(d.total),
              strokeWidth: 0,
              inset: 1
            }),
            Plot.text(mapData, {
              x: "col",
              y: "row",
              fontWeight: "bold",
              fill: (d) => (d.total < threshold ? "#333" : "#eee"),
              text: (d) => `${d.code}\n${formatNum(d.total)}`
            })
          ];
        },
        highlight(e) {
          if (focus !== null) return;
          const index = getTargetIndex(e);
          fill(index, true);
          if (timeout) clearTimeout(timeout);
          timeout = setTimeout(
              () => updateState(index >= 0 ? lookupState(index) : null),
              25
          );
        },
        restore(e) {
          if (this.focus !== null) return;
          const index = this.getTargetIndex(e);
          this.fill(index);
        },
        fill(index, highlight = false, darker = 0) {
          if (index >= 0) {
            const color = highlight ? "#edc949" : this.colors(this.mapData[index].total);
            d3.select(`#map-container rect:nth-child(${index + 1})`)
              .attr("fill", darker ? d3.color(color).darker(darker) : color)
              .attr("stroke-width", highlight ? 1 : 0);
          }
        },
        handleClick(e) {
          const index = this.getTargetIndex(e);
          if (this.focus === index) {
            this.focus = null;
            return;
          }

          if (this.focus !== null) this.fill(this.focus);
          if (index >= 0) {
            this.fill(index, true);
            this.focus = index;
            this.updateState(this.lookupState(index));
          } else {
            this.focus = null;
            this.updateState(null);
          }
        },
        handlePointerDown(e) {
          const index = this.getTargetIndex(e);
          if (index >= 0) this.fill(index, true, 0.25);
        },
        handlePointerUp(e) {
          const index = this.getTargetIndex(e);
          if (index >= 0) this.fill(index, true);
        },
        getTargetIndex(e) {
          let tar = e.target;
          if (tar instanceof SVGTSpanElement) tar = tar.parentElement;
          return tar instanceof SVGTextElement || tar instanceof SVGRectElement
              ? [...tar.parentElement.children].indexOf(tar) : -1;
        },
        lookupState(index) {
          return this.mapData[index].code;
        },
        updateState(state) {
          const mapElement = document.getElementById('map');
          if (mapElement) {
            mapElement.value = state;
            mapElement.dispatchEvent(new CustomEvent("input"));
          }
        },
      }
    })
  </script>
{% endblock %}


